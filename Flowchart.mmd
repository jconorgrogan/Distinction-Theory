flowchart TD
    %% ───────── PRE-EVENT LAYERS ─────────
    P0["P-0 Latent possibility<br/>(substrate admits ≥ 2 micro-configs)"]
    P1["P-1 Enablement<br/>(one writable slot + non-zero noise)"]
    P0 --> P1

    %% ───────── EVENT ─────────
    F0["F0 Registered Contrast<br/>(difference actually recorded)"]
    P1 --> F0

    %% ───────── IMMEDIATE CONSEQUENCES ─────────
    subgraph C0["C-0 Immediate consequences"]
        C0_1["Multiplicity realised"]
        C0_2["Trace persists"]
        C0_3["Asymmetric before → after"]
    end
    F0 --> C0

    %% ───────── STRUCTURAL NECESSITIES ─────────
    subgraph C1["C-1 Structural necessities"]
        L1["Identity & ¬Contradiction"]
        EFR["Explosion-Free Reference"]
        FA["Finite action per cycle"]
    end
    C0 --> C1

    %% ───────── FINITE REACHABLE SET ─────────
    FRS["C-2 FRS Finite Reachable Set"]
    C1 --> FRS

    %% ───────── DYNAMICS BRANCH ─────────
    DYN{"C-3 Internal dynamics?"}
    FRS --> DYN
    STAT["Static system"]
    DYNyes["Dynamic system"]
    DYN --> STAT
    DYN --> DYNyes

    %% ───────── NOVELTY BRANCH ─────────
    NOVEL{"C-4 Sufficient novelty?"}
    DYNyes --> NOVEL
    LOWNOV["Insufficient novelty<br/>(no saturation)"]
    SATRISK["L5 Saturation risk"]
    NOVEL --> LOWNOV
    NOVEL --> SATRISK

    %% ───────── COST NECESSITY ─────────
    COST["C-5 C1 + RCR<br/>(non-zero operation cost)"]
    SATRISK --> COST

    %% ───────── PERSISTENCE BRANCH ─────────
    PERS{"C-6 Persistence objective?"}
    COST --> PERS
    HALT["No → halt/fail"]
    YESPO["Yes → must continue"]
    PERS --> HALT
    PERS --> YESPO

    %% ───────── SUR OPTIMISATION ─────────
    SUR["C-7 SUR<br/>(minimise L = K + λE)"]
    YESPO --> SUR

    %% ───────── FINAL CLASS ─────────
    FINAL["SUR-systems<br/>(cost-optimising, logical)"]
    SUR --> FINAL

    %% Styling
    classDef final fill:#e1f5fe,stroke:#0277bd,stroke-width:2px;
    class FINAL final
    classDef dead fill:#ffe0e0,stroke:#d32f2f,stroke-width:1px,stroke-dasharray:4 2;
    class HALT,LOWNOV,STAT dead
