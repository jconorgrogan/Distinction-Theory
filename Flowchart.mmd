flowchart TD
    %% ───────── PART A · IC LADDER WITH ARROW-OF-TIME ─────────
    P0["P-0 Latent multiplicity<br/>(S₀ vs Ω distinction)"]
    P1["P-1 Writable / noisy slot<br/>(unstable S₀ ∥ Ω boundary)"]
    P0 --> P1

    F0["F0 Registered Contrast<br/>(first forced bit)"]
    P1 -- "Δ_gen" --> F0

    subgraph C0["C-0 Immediate consequences"]
        C0_1["Multiplicity realised"]
        C0_2["Trace persists"]
        C0_3["Asymmetric before → after"]
        C0_4["Non-invertible Δ ⇒ DAG"]
        C0_5["Proto-arrow:<br/>earlier ≺ later"]
        C0_6["Minimal memory:<br/>present encodes ancestors"]
    end
    F0 --> C0_1
    F0 --> C0_2
    F0 --> C0_3

    %% Proto-arrow theorem reference
    PAT0["PA-Thm-0<br/>Non-injective Δ ⇒ partial order ⇒ time-like chains"]
    classDef note fill:#ffffe0,stroke:#9e9e9e,stroke-dasharray:4 3;
    class PAT0 note
    C0_3 -.-> PAT0
    PAT0 -.-> C0_4

    C0_3 --> C0_4
    C0_4 --> C0_5
    C0_5 --> C0_6

    subgraph C1["C-1 Structural necessities"]
        L1["Identity & ¬Contradiction<br/>(forced by DAG semantics)"]
        EFR["Explosion-Free Reference"]
        FA["Finite action per cycle"]
    end
    C0_1 --> L1
    C0_2 --> EFR
    C0_3 --> FA
    C0_4 -. "ordering ensures" .-> L1
    C0_6 -. "first stable ref" .-> EFR

    FRS["C-2 Finite Reachable Set (S-FiniteQ)"]
    C1 --> FRS
    FRS -- "Δ_id" --> FRS

    DYN{"C-3 Internal dynamics?"}
    FRS --> DYN
    TERMINAL["Static / Halt<br/>(terminal object)"]
    class TERMINAL dead
    DYNyes["Dynamic system"]
    DYN -- "No"  --> TERMINAL
    DYN -- "Yes" --> DYNyes

    REC["C-3a Recurrence forced<br/>(pigeon-hole)"]
    DYNyes --> REC

    NOVEL{"C-4 Sufficient novelty?"}
    REC --> NOVEL
    LOWNOV["Insufficient novelty<br/>(no saturation)"]
    SATRISK["L5 Saturation risk"]
    NOVEL -- "No"  --> LOWNOV
    NOVEL -- "Yes" --> SATRISK

    COST["C-5 Non-zero op cost (S-Cost)<br/>(ΔH > 0 or ΔE ≥ kBT ln 2)"]
    SATRISK --> COST

    PERS{"C-6 Persistence objective?"}
    COST --> PERS
    YESPO["Persist"]
    PERS -- "No"  --> TERMINAL
    PERS -- "Yes" --> YESPO

    SUR["C-7 SUR<br/>(minimise L = K + λE)"]
    YESPO --> SUR

    FINAL["SUR-systems<br/>(cost-optimising, logical)"]
    class FINAL final
    SUR --> FINAL

    TOT["**Arrow of Time starts here.**<br/>C0-4 forces a DAG.<br/>The ≤₍info₎ order in that DAG<br/>*is* the arrow; memory (C0-6)<br/>stores its irreversible footprint."]
    class TOT note
    C0_6 --> TOT

    %% Styling for part A
    classDef final fill:#e1f5fe,stroke:#0277bd,stroke-width:2px;
    classDef dead  fill:#ffe0e0,stroke:#d32f2f,stroke-width:1px,stroke-dasharray:4 2;

    %% ───────── PART B · HOW A LOOP APPEARS AFTER COLLAPSE ─────────
    subgraph Loop_Demo["Event vs Collapsed View – cycles arise only after forgetting timestamps"]
        direction LR
        subgraph EV["Event-level DAG (acyclic – full info)"]
            A0["(s0, t₀)"] --> A1["(s1, t₁)"] --> A2["(s0, t₂)"] --> A3["(s1, t₃)"]
        end
        subgraph CV["Collapsed state graph (cycle emerges)"]
            S0((s0)) --> S1((s1)) --> S0
        end
    end

    %% Colour links for clarity in Part B
    linkStyle 0,1,2,3 stroke:#1f77b4,stroke-width:2px;   %% event-level
    linkStyle 4,5 stroke:#d62728,stroke-width:2px;       %% collapsed cycle
